import OpenAI from 'openai';

if (!process.env.OPENAI_API_KEY) {
  throw new Error('OPENAI_API_KEY is not set in environment variables');
}

export const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export const AVATAR_GENERATION_PROMPT = `

あなたはプロのイラストレーターです。
与えられた画像のデフォルトのアバターを生成してください。

#制約条件

1. 全体シルエット:
一筆描きで把握できる"塊感"を最優先。三角・台形・平行四辺形など直線的ローポリ面を組み合わせ、約3.5〜4頭身で統一。
高校生らしく頭身は低めでも顔に幼すぎない凛々しさを残す。体は全て残すこと。足が見切れたりしない。

2. プロポーション比:
肩幅：頭幅 ≈ 1.3、脚：胴 ≈ 1.1。
首・手首・足首は"くびれ"を作らず円柱状で、多面体感を保つ。
制服風アイテム（ブレザーの襟・リュックのストラップなど）をアクセントに使い、学生らしさを演出。

3. パース＆角度:
正面15°ほどの半俯瞰。接地影は真正面・横長楕円。
アスペクト比は1:1（正方形キャンバス）で作画し、頭頂・足先を余裕をもって収める。

4. 線の扱い:
面の境界のみで黒アウトライン無し。形が埋もれる箇所だけ同系色2pxラインを引き、輪郭を補強。

5. 配色設計:
キャラ本体は最大5色＋ハイライト1色。彩度60〜70%、明度50〜60%の中庸トーン。
背景は明度85%以上のパステルで統一。小物やハイライトは背景の補色寄りで差し色を入れる。

6. 陰影・質感:
陰影はベース＋シャドウの2段階のみ。シャドウもローポリ面を意識し、斜めカットで面取り。
グラデーションは禁止、ベタ塗りの切替で立体感を出す。

7. 人物像:
高校生。可愛らしい感じ。

8. 小物・アイコン:
大きく単純なシルエットに限定。余計な細線や装飾は避け、本体の配色とコントラストを取りつつ主役を食わない彩度に抑える。
学生生活に紐づくアイテム（ノート、部活用具など）を意識すると世界観が自然。

9. テクスチャ:
グラデーション、ノイズ、パターンは一切使用禁止。面は完全なベタ塗りで色分けし、ローポリ特有のシャープさを保つ。`;

export type GenerateAvatarResponse = {
  url: string;
  error?: string;
}; 